<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script> 
</head>
<body>
    <div class="container">
        <header>
            <h1>Hello, <span id="user-display-name">Student</span>!</h1>
            <p>Welcome to your Zone Wagoora Winter Learning Portal.</p>
            <button id="logout-button">Logout</button>
        </header>

        <section class="menu">
            <a href="quiz.html" class="menu-item">ğŸ“ Daily MCQs</a>
            <a href="leaderboard.html" class="menu-item">ğŸ† Live Leaderboard</a>
            <a href="resources.html" class="menu-item">ğŸ“š Assignments & Resources</a>
        </section>

        <section class="notifications">
            <h2>ğŸ“¢ Notifications</h2>
            <div id="scrolling-content">
                <p>Day 1 Quiz is now LIVE! Submit your answers before 10 PM.</p>
                <p>Reminder: All Class 9 assignments are due on Jan 5th.</p>
                <p>Note: Check your rank on the Leaderboard!</p>
            </div>
        </section>

    </div>

    <script>
        // *** UPDATED FIREBASE CONFIGURATION ***
        const firebaseConfig = {
          apiKey: "AIzaSyCBLLmzxVYuivT15HBPPSxMoS2OzojRgJM",
          authDomain: "wap-ps-pethgam.firebaseapp.com",
          databaseURL: "https://wap-ps-pethgam-default-rtdb.firebaseio.com",
          projectId: "wap-ps-pethgam",
          storageBucket: "wap-ps-pethgam.firebasestorage.app",
          messagingSenderId: "430925411362",
          appId: "1:430925411362:web:22857dee585d02fc54467b"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore(); 
        const logoutButton = document.getElementById('logout-button');
        const displayName = document.getElementById('user-display-name');
        const menuSection = document.querySelector('.menu');

        // --- Role Check and Dashboard Loading ---
        auth.onAuthStateChanged((user) => {
            if (user) {
                displayName.textContent = user.email.split('@')[0];

                db.collection("user_roles").doc(user.uid).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const userRole = doc.data().role;
                            
                            if (userRole === 'admin') {
                                const adminMenu = document.createElement('a');
                                adminMenu.href = 'admin_tools.html';
                                adminMenu.className = 'menu-item admin-only';
                                adminMenu.innerHTML = 'âš™ï¸ **Admin Tools** (User Mgmt)';
                                menuSection.prepend(adminMenu); 
                            } 
                            
                            else if (userRole === 'teacher') {
                                const teacherMenu = document.createElement('a');
                                teacherMenu.href = 'teacher_tools.html'; 
                                teacherMenu.className = 'menu-item teacher-only';
                                teacherMenu.innerHTML = 'ğŸ **Teacher Tools** (Quiz/Grades)';
                                menuSection.prepend(teacherMenu); 
                            }
                            
                        } else {
                            console.log("No role document found for this user.");
                        }
                    })
                    .catch((error) => {
                        console.error("Error retrieving user role:", error);
                    });

            } else {
                window.location.href = 'index.html';
            }
        });

        // --- Logout functionality ---
        logoutButton.addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error("Logout Error:", error);
            });
        });
    </script>
</body>
</html>
